<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Acc√®s r√©serv√© ‚Äì Email requis</title>
  <meta name="description" content="Entrez votre e-mail pour d√©verrouiller l‚Äôacc√®s. Le lien vous sera envoy√© par e-mail ‚Äî utilisez une adresse r√©elle." />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg:#f6efe6;          /* beige clair */
      --card:#fff8ef;        /* carte */
      --text:#1b1b1b;        /* texte principal */
      --muted:#6b6b6b;
      --accent:#111;         /* bouton sombre √©l√©gant */
      --accentText:#fff;
      --border:#e9dccb;      /* bordure douce */
      --badge:#ffecd1;       /* bandeau annonce */
      --badgeText:#7a4b00;
      --ok:#15803d;          /* vert succ√®s */
      --err:#b91c1c;         /* rouge erreur */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
      display:grid; place-items:center; padding:20px;
    }
    .card{
      width:100%; max-width:520px; background:var(--card); border:1px solid var(--border);
      border-radius:20px; box-shadow:0 10px 40px rgba(0,0,0,.06);
      padding:22px 20px;
    }
    .ribbon{
      display:flex; align-items:center; gap:8px;
      background:var(--badge); color:var(--badgeText);
      border:1px solid #f3d9b0; border-radius:999px; padding:6px 12px; font-weight:700; width:max-content;
    }
    h1{margin:14px 0 6px; font-size:26px}
    .sub{margin:0 0 16px; color:var(--muted); line-height:1.55}
    label{display:block; font-size:14px; margin-bottom:6px}
    .input{
      width:100%; padding:14px 16px; border-radius:14px; font-size:16px;
      border:1px solid var(--border); outline:none; background:#fff; color:var(--text);
      transition:box-shadow .2s, border-color .2s;
    }
    .input:focus{border-color:#cdb79a; box-shadow:0 0 0 6px rgba(205,183,154,.25)}
    .btn{
      margin-top:14px; width:100%; padding:14px 16px; border-radius:14px; font-weight:800; letter-spacing:.2px;
      background:var(--accent); color:var(--accentText); border:none; cursor:pointer;
      box-shadow:0 8px 24px rgba(0,0,0,.12); transition:transform .06s ease, filter .15s ease;
    }
    .btn:hover{filter:brightness(1.04)}
    .btn:active{transform:translateY(1px) scale(.995)}
    .btn[disabled]{opacity:.6; cursor:not-allowed}
    .msg{margin-top:10px; font-size:14px}
    .ok{color:var(--ok)}
    .err{color:var(--err)}
    .timer{margin-top:8px; font-size:12px; color:#7a6a50}
    .hint{
      margin-top:14px; font-size:13px; color:#7a6a50; background:#fff; border:1px dashed var(--border);
      padding:10px 12px; border-radius:12px;
    }
    .info{margin-top:10px; font-size:13px; color:var(--muted)}
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="title">
    <div class="ribbon">üì¢ Annonce en ligne</div>
    <h1 id="title">Acc√®s r√©serv√© ‚Äì Email requis</h1>
    <p class="sub">
      Entrez votre adresse e-mail pour d√©verrouiller l‚Äôacc√®s.<br />
      <strong>Vous recevrez le lien par e-mail</strong> ‚Äî utilisez une adresse <em>r√©elle</em>.
    </p>

    <form id="gateForm" novalidate>
      <label for="email">Adresse e-mail</label>
      <input id="email" class="input" type="email" inputmode="email" autocomplete="email"
             placeholder="prenom.nom@email.com"
             required aria-required="true" />
      <button id="submitBtn" class="btn" type="submit">D√©verrouiller</button>
      <div id="message" class="msg" role="status" aria-live="polite"></div>
      <div id="timer" class="timer" hidden>Fermeture dans <span id="sec">8</span>s‚Ä¶</div>
    </form>

    <div class="hint">Astuce : si tu ne re√ßois pas l‚Äôe-mail, v√©rifie les spams/promotions.</div>
    <div class="info">‚ÑπÔ∏è Cette page fonctionne dans la WebApp Telegram et envoie ton e-mail au bot pour d√©bloquer l‚Äôacc√®s.</div>
  </main>

  <script>
    (function(){
      "use strict";

      // 1) (Optionnel) Mets ici ton endpoint Systeme.io si tu veux l'appeler aussi depuis la page.
      //    Laisse vide si tu n'en as pas (GitHub Pages, etc.).
      //    Exemple : "https://systeme.io/form/abcd-1234/submit" (selon ton setup)
      const SYSTEMEIO_URL = ""; // <= mets ton URL Systeme.io ici ou laisse ""

      // 2) Telegram WebApp SDK
      const tg = (window.Telegram && Telegram.WebApp) ? Telegram.WebApp : null;
      if (!tg) {
        console.warn("‚ö†Ô∏è Telegram.WebApp est NULL ‚Äî ouvre cette page via le bouton du bot, pas dans un navigateur.");
      } else {
        try { tg.ready(); tg.expand(); } catch(e){}
      }

      // 3) Elements & helpers
      const form = document.getElementById("gateForm");
      const emailInput = document.getElementById("email");
      const submitBtn = document.getElementById("submitBtn");
      const message = document.getElementById("message");
      const timerBox = document.getElementById("timer");
      const sec = document.getElementById("sec");

      const EMAIL_RE = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      function setMsg(text, cls){
        message.textContent = text || "";
        message.className = "msg " + (cls || "");
      }
      function startCountdown(n=8){
        timerBox.hidden = false;
        sec.textContent = String(n);
        const iv = setInterval(()=>{
          n -= 1;
          sec.textContent = String(n);
          if (n <= 0){
            clearInterval(iv);
            try { if (tg) tg.close(); } catch(_) {}
          }
        }, 1000);
      }

      // 4) Submit handler
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        setMsg("");

        const email = (emailInput.value || "").trim();
        if (!EMAIL_RE.test(email)) { setMsg("Merci d'entrer un e-mail valide.", "err"); return; }

        submitBtn.disabled = true; submitBtn.textContent = "Envoi‚Ä¶";

        // (A) Envoi imm√©diat au bot ‚Üí d√©blocage instantan√© m√™me sans backend
        try {
          if (tg) {
            tg.sendData(JSON.stringify({ email }));
            // petit log debug (visible avec outils dev Android seulement)
            console.log("Envoi √† Telegram:", { email });
          }
        } catch(e){ console.error("sendData error:", e); }

        // (B) Tentative d‚Äôenvoi √† Systeme.io en parall√®le (si URL fournie)
        if (SYSTEMEIO_URL) {
          try {
            // no-cors : on ne lit pas la r√©ponse, mais la requ√™te part.
            await fetch(SYSTEMEIO_URL, {
              method: "POST",
              mode: "no-cors",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body: new URLSearchParams({ email })
            });
            setMsg("‚úîÔ∏è Inscription en cours. Le lien arrive par e-mail.", "ok");
          } catch(err){
            console.warn("Systeme.io fetch failed:", err);
            setMsg("‚úîÔ∏è Email envoy√© au bot. L‚Äôinscription e-mail sera finalis√©e c√¥t√© serveur.", "ok");
          }
        } else {
          setMsg("‚úîÔ∏è Email envoy√©. Vous recevrez le lien par e-mail.", "ok");
        }

        // UI finale + fermeture avec timer
        emailInput.setAttribute("disabled", "true");
        startCountdown(8);

        submitBtn.disabled = false; submitBtn.textContent = "D√©verrouiller";
      });
    })();
  </script>
</body>
</html>
